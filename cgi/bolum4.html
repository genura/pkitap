<html>

<head>

<meta http-equiv="Content-Type" content="text/html; charset=windows-1254">
<link rel="shortcut icon" href="/grafik/sinanilyas.ico">
<title>[ www.sinanilyas.com ]</title>
<link rel="stylesheet" type="text/css" href="/css/ortak.css">

</head>

<body>

<table cellspacing="0" cellpadding="0" align="center" border="0" width= "99%">
	<tr style="text-align: center;">
		<td style="background: url(/grafik/cerceve-sol-ust.gif); width:29px; height: 29px;"></td>
		<td style="background: url(/grafik/cerceve-ust.gif); height: 29px;"></td>
		<td style="background: url(/grafik/cerceve-sag-ust.gif); width:29px; height: 29px;"></td>
	</tr>
	<tr>
		<td style="background: url(/grafik/cerceve-sol.gif); width: 29px;"></td>
		<td style="padding-left: 10px; padding-right: 10px; padding-top: 30px; padding-bottom: 10px;">
			<p class="sayfabasligi">Bölüm 4</p>

			<!-- Gövde metni baþlangýcý -->

<p></p>

POST metodunda bilgiler URL ile birlikte gönderilmediði GET metodundan daha güvenlidir. POST metodunun GET metoduna bir diðer üstünlüðü de daha fazla bilgi gönderebilmesidir. Ayrýca, GET metodu ile gönderilen bilgiler web browser, web server ya da proxy server'ýn kaþe belleðinde (cache) saklanabilir fakat POST metodu ile bilgiler her defasýnda yeniden gönderilir. Dezavantajý ise POST ile gönderilen bilgiler daha karmaþýk olacaðýndan dolayý bu bilgileri çözmek için daha biraz daha karmaþýk bir kod yazmamýz gerekir.

<p>
Web server, form bilgilerini CGI programýna kodlayarak gönderir. Alfanumerik karakterler olduðu gibi gönderilir; boþluklar artý (+) iþaretine çevrilir; tab, çift týrnak (&quot;) gibi özel iþaretler de &quot;%HH&quot; þeklinde kodlanýr. Burada &quot;HH&quot; karakterin ASCII karþýlýðýnýn hexadesimal (16'lýk sistemdeki) deðeridir. Bu kodlama iþlemine &quot;URL kodlama&quot; denir. Aþaðýdaki tabloda sýk kullanýlan bazý karakterlerin kodlanmýþ karþýlýklarýný görebilirsiniz.

<p>
<div align="center">
<table border="1">

<tr><td align="center" width="100">
<font face="tahoma" size="2"><b>Normal<br>Karakter</b></font>
</td><td align="center" width="100">
<font face="tahoma" size="2"><b>Kodlanmýþ<br>Hali</b></font>
</td></tr>

<tr><td align="center">
<font face="courier new" size="2">&nbsp;\n (enter)</font>
</td><td align="center">
<font face="courier new" size="2">&nbsp;%0A</font>
</td></tr>

<tr><td align="center">
<font face="courier new" size="2">&nbsp;\t (tab)</font>
</td><td align="center">
<font face="courier new" size="2">&nbsp;%09</font>
</td></tr>

<tr><td align="center">
<font face="courier new" size="2">&nbsp;/</font>
</td><td align="center">
<font face="courier new" size="2">&nbsp;%2F</font>
</td></tr>

<tr><td align="center">
<font face="courier new" size="2">&nbsp;~</font>
</td><td align="center">
<font face="courier new" size="2">&nbsp;%7E</font>
</td></tr>

<tr><td align="center">
<font face="courier new" size="2">&nbsp;:</font>
</td><td align="center">
<font face="courier new" size="2">&nbsp;%3A</font>
</td></tr>

<tr><td align="center">
<font face="courier new" size="2">&nbsp;;</font>
</td><td align="center">
<font face="courier new" size="2">&nbsp;%3B</font>
</td></tr>

<tr><td align="center">
<font face="courier new" size="2">&nbsp;@</font>
</td><td align="center">
<font face="courier new" size="2">&nbsp;%40</font>
</td></tr>

<tr><td align="center">
<font face="courier new" size="2">&nbsp;&amp;</font>
</td><td align="center">
<font face="courier new" size="2">&nbsp;%26</font>
</td></tr>

</table>
</div>

<p>
Gönderilen bilgiyle iþe yarar þeyler yapabilmek için CGI bu kodlanmýþ bilgiyi çözmelidir. Neyse ki Perl'de <font face="courier new">substitute</font> ve <font face="courier new">translate</font> komutlarýyla bunu yapmak oldukça kolaydýr. Perl, karakter içerisinde arama yapma ve deðiþtirme konusunda oldukça yeteneklidir. <font face="courier new">substitute</font> komutunun temel yazýlýþ biçimi aþaðýdaki gibidir.

<ul>
<font face="courier new">$yazi =~ s/aranan/yerinekonan/;</font>
</ul>

<p>
Bu örnek <font face="courier new">$yazi</font> scalar deðiþkeninde <font face="courier new">aranan</font> kelimesinin yerine <font face="courier new">yerinekonan</font> kelimesini koyar. Araya konan operatör <font face="courier new">=~</font> (eþittir ve yanýnda tilde) iþaretidir.
<p>
Daha iyi anlaþýlacaðýný düþündüðüm baþka bir örnek:

<ul>
<font face="courier new">
$selamlama = "Merhaba. Benim adým xisimx.\n";<br>
$selamlama =~ s/xnamex/Sinan/;<br>
print $selamlama;
</font>
</ul>

<p>
Yukarýdaki örnek &quot;Merhaba. Benim adým Sinan.&quot; yazdýracaktýr. <font face="courier new">$selamlama</font> deðiþkeninde &quot;xisimx&quot;in yerini &quot;Sinan&quot;ýn aldýðýna dikkat edin.

<p>
Buna yakýn fakat bir parça farklý bir komut da <font face="courier new">translate</font> komutudur.

<p>
<ul>
<font face="courier new">$yazi =~ tr/arananlistesi/yerinekonanlistesi/;</font>
</ul>

<p>
Bu komut &quot;arananlistesi&quot;ndeki bütün karakterleri &quot;yerinekonan&quot; listesindekilerle deðiþtirir. Ýþte bir örnek:

<p>
<ul>
<font face="courier new">$kucukh =~ tr/[A-Z]/[a-z]/;</font>
</ul>

<p>
Bu örnek bütün yazýyý küçük harfe çevirir. <font face="courier new">[A-Z]</font>'deki parantezler karþýlaþtýrýlacak karakter sýnýfýný belirtir.

<p>
Þimdi tekrar formlara dönelim. Formla gönderilen bilginin kodunu çözmeniz için bilgide iki deðiþiklik yapmalýsýnýz:

<p>
<ul>
<font face="courier new">$value =~ tr/+/ /;<br>
$value =~ s/%([a-fA-F0-9][a-fA-F0-9])/pack(&quot;C&quot;, hex($1))/eg;
</font>
</ul>

<p>
Ýlk satýrda <font face="courier new">+</font> iþaretleri boþluða çevrilir. Ýkinci satýrda ise <font face="courier new">pack()</font> fonksiyonu kullanýlarak <font face="courier new">%HH</font> hex çiftleri ASCII karþýlýklarýna çevrilir.

<p>
Þimdi &quot;post.cgi&quot; adýnda yeni bir CGI hazýrlayalým.

<p>
<ul>
<font face="courier new">
#!/usr/bin/perl<br>
<br>
print &quot;Content-type:text/html\n\n&quot;;<br>
<br>
read(STDIN, $tampon, $ENV{'CONTENT_LENGTH'});<br>
@ciftler = split(/&/, $tampon);<br>
foreach $cift (@ciftler) {<br>
&nbsp;&nbsp;&nbsp;($isim, $deger) = split(/=/, $cift);<br>
&nbsp;&nbsp;&nbsp;$deger =~ tr/+/ /;<br>
&nbsp;&nbsp;&nbsp;$deger =~ s/%([a-fA-F0-9][a-fA-F0-9])/pack(&quot;C&quot;, hex($1))/eg;<br>
&nbsp;&nbsp;&nbsp;$FORM{$isim} = $deger;<br>
}<br>
<br>
print &quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;Form Bilgileri&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&quot;;<br>
print &quot;&lt;h2&gt;Formla gönderilen bilgiler:&lt;/h2&gt;\n&quot;;<br>
<br>
foreach $anahtar (keys(%FORM)) {<br>
&nbsp;&nbsp;&nbsp;print &quot;$anahtar = $FORM{$anahtar}&lt;br&gt;&quot;;<br>
}<br>
<br>
print &quot;&lt;/body&gt;&lt;/html&gt;&quot;;
</font>
</ul>

<p>
Þimdi yukarýdaki kodlarý açýklayalým. Form ile gönderilen bilgi önce <font face="courier new">$tampon</font> scalar deðiþkenine okunuyor. Sonra <font face="courier new">&amp;</font> iþaretlerinden ayrýlarak elde edilen &quot;formdegiskeni=deger&quot; þeklindeki form alaný bilgileri <font face="courier new">@ciftler</font> dizisine yerleþtiriliyor. Sonra <font face="courier new">foreach</font> döngüsünde herbir form alaný bilgisi <font face="courier new">=</font> iþaretinden ayrýlýyor ve URL kodu çözülerek <font face="courier new">%FORM</font> Hash deðiþkenine atanýyor. <font face="courier new">%FORM</font> deðiþkenindeki anahtar adlarý form alanýnýn adýdýr. Mesela <font face="courier new">&lt;input type=&quot;text&quot; name=&quot;<b>ad</b>&quot; size=30&gt;</font> HTML kodunda koyu yazýlan &quot;ad&quot; deðeri form alanýnýn adýdýr. Formunuzda &quot;ad&quot; ve &quot;soyad&quot; isimli iki form alaný varsa scriptinizde bu deðerleri <font face="courier new">$FORM{'ad'}</font> ve <font face="courier new">$FORM{'soyad'}</font> þeklinde kullanabilirsiniz.

<p>
Aþaðýdaki örneði inceleyerek <font face="courier new">split</font> fonksiyonunun nasýl çalýþtýðýný hatýrlayalým.

<p>
<ul>
<font face="courier new">
$yazi = &quot;sari&amp;kirmizi&amp;yesil&quot;;<br>
@renkler = split(/&amp;/,$yazi);
</font>
</ul>

<p>
<font face="courier new">@renkler</font> deðiþkeninin yeni deðeri (&quot;sari&quot;,&quot;kirmizi&quot;,&quot;yesil&quot;) olur.

<p>
Þimdi de scriptimizi denemeye geldi sýra. Form için aþaðýdaki kodlarý kullanarak bir HTML dosyasý oluþturun ve &quot;post.html&quot; adýyla kaydedin.
<p>
<ul>
<font face="courier new">
&lt;form action=&quot;http://www.sinanilyas.com/cgi-bin/ornek/post.cgi&quot; method=&quot;POST&quot;&gt;<br>
&lt;pre&gt;<br>
&nbsp;&nbsp;&nbsp;Adýnýz: &lt;input type=&quot;text&quot; name=&quot;ad&quot; size=30&gt;&lt;br&gt;<br>
Soyadýnýz: &lt;input type=&quot;text&quot; name=&quot;soyad&quot; size=30&gt;&lt;br&gt;<br>
&lt;/pre&gt;<br>
&lt;input type=&quot;submit&quot; value=&quot;Gönder&quot;&gt;<br>
&lt;input type=&quot;reset&quot; value=&quot;Tümünü Sil&quot;&gt;<br>
&lt;/form&gt;
</font>
</ul>

<p>
<img src="../grafik/ok-1.gif" width="13" height="15" align="absmiddle"> 
<a href="ornek/post.html" target="ornek">Denemek için týklayýn</a>

<p>
Ýsterseniz scriptimizi biraz daha geliþtirelim. Scriptimiz form bilgilerini 
mail adresimize göndersin. Ýlk önce sistemimizde sendmail programýnýn nerede olduðunu bulalým. Bunu öðrenmek için <font face="courier new">which sendmail</font> ya da <font face="courier new">whereis sendmail</font> komutunu kullanabilirsiniz. (sinanilyas.com için bu programýn yeri /usr/sbin/sendmail olduðundan örneklerimizde bu þekilde kullanacaðýz. Eðer sizin server'ýnýzda farklý bir yerde ise kendi server'ýnýzdaki yerini yazmanýz gerekir.)

<p>
<b>Not:</b> <font face="courier new">@</font> iþaretini çift týrnak arasýnda ya da <font face="courier new">print &lt;&lt;HTMLSonu</font> bloðunda kullanýrken önüne <font face="courier new">&quot;mail\@adres.com&quot;</font> örneðindeki gibi <font face="courier new">\</font> iþareti koymalýsýnýz. Tek týrnak arasýnda <font face="courier new">'mail@adres.com'</font> örneðinde olduðu gibi <font face="courier new">\</font> iþareti koymadan güvenle kullanabilirsiniz.

<p>
<ul>
<font face="courier new">
#!/usr/bin/perl<br>
<br>
print &quot;Content-type:text/html\n\n&quot;;<br>
<br>
read(STDIN, $tampon, $ENV{'CONTENT_LENGTH'});<br>
@ciftler = split(/&amp;/, $tampon);<br>
foreach $cift (@ciftler) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;($isim, $deger) = split(/=/, $cift);<br>
&nbsp;&nbsp;&nbsp;&nbsp;$deger =~ tr/+/ /;<br>
&nbsp;&nbsp;&nbsp;&nbsp;$deger =~ s/%([a-fA-F0-9][a-fA-F0-9])/pack(&quot;C&quot;, hex($1))/eg;<br>
&nbsp;&nbsp;&nbsp;&nbsp;$FORM{$isim} = $deger;<br>
}<br>
<br>
$mailprog = '/usr/sbin/sendmail';<br>
<br>
# bunu kendi mail adresinizle deðiþtirin<br>
<br>
$gonderilen = 'mail@adres.com';<br>
<br>
# burada maili göndermek üzere sendmail programý açýlýyor<br>
# eðer sendmail programý bulunamazsa hata alt programý (en altta)<br>
# iþletilerek programýn bulunamadýðý yazýyor<br>
<br>
open (MAIL, &quot;|$mailprog -t&quot;) or &amp;hata(&quot;$mailprog bulunamadý!\n&quot;);<br>
<br>
# sendmail programýna mailin kime gönderileceði bildiriliyor<br>
<br>
print MAIL &quot;To: $gonderilen\n&quot;;<br>
<br>
# sendmail programýna ziyaretçinin email adresi bildiriliyor.<br>
# bu &quot;Yanýtla&quot; tuþuna bastýðýnýzda iþe yarar<br>
# kullanmak zorunda deðilsiniz<br>
# formunuzda 'email' ve 'isim' kutularýnýn bulunduðu varsayýlmýþtýr.<br>
<br>
print MAIL &quot;Reply-to: $FORM{'email'}\n&quot;;<br>
<br>
# sendmail programýna mailin konusu gönderiliyor<br>
# konudan sonra iki tane \n olduðuna dikkat edin<br>
<br>
print MAIL &quot;Subject: Form Bilgileri\n\n&quot;;<br>
<br>
# sendmail programýna form bilgileri gönderiliyor<br>
<br>
foreach $anahtar (keys(%FORM)) {<br>
&nbsp;&nbsp;&nbsp;print MAIL &quot;$anahtar = $FORM{$anahtar}\n&quot;;<br>
}<br>
<br>
# bilgiler gönderildikten sonra sendmail programýný kapatmayý unutmayýn<br>
<br>
close(MAIL);<br>
<br>
# teþekkür sayfasý oluþturuluyor<br>
<br>
print &lt;&lt;HTMLSonu;<br>
&lt;html&gt;&lt;head&gt;&lt;title&gt;Teþekkürler&lt;/title&gt;&lt;/head&gt;&lt;body&gt;<br>
&lt;h2&gt;Teþekkürler&lt;/h2&gt;<br>
Mailiniz gönderildi. Formu gönderdiðiniz için teþekkürler&lt;p&gt;<br>
&lt;/body&gt;&lt;/html&gt;<br>
HTMLSonu<br>
;<br>
<br>
# hata alt programý<br>
<br>
sub hata {<br>
&nbsp;&nbsp;&nbsp;&nbsp;($hatamesaji) = @_;<br>
&nbsp;&nbsp;&nbsp;&nbsp;print &quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;Hata!&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&quot;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;print &quot;&lt;h2&gt;Hata&lt;/h2&gt;\n&quot;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;print &quot;$hatamesaji&lt;p&gt;\n&quot;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;print &quot;&lt;/body&gt;&lt;/html&gt;\n&quot;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;exit;<br>
}
</font>
</ul>

<p>
Yukarýdaki scriptte yeni bir yapý kullandýk: <font face="courier new">hata</font> isimli bir &quot;alt program&quot;. Alt programlar programlarýn sadece çaðýrýldýklarý zaman iþletilen komutlarýdýr diyebiliriz. Örneðimizde <font face="courier new">hata</font> alt programý sadece sendmail programý bulunamazsa çalýþtýrýlýr. Programýnýzýn bu durumda size bir server hatasý vermesi yerine neyin yanlýþ gittiðine dair bilgi vermesini istersiniz. <font face="courier new">hata</font> alt programýyla bu yapýlýyor. sendmail programýnýn bulunmadýðýný bildiren bir web sayfasý gösteriyor ve Perl'den çýkýyor. Perl'de alt programlar <font face="courier new">&amp;altprogramadi</font> ya da <font face="courier new">&amp;atlprogramadi (argümanlar)</font> þeklinde çaðrýlýr. Argümanlar alt programa gönderilen deðerlerdir.

<p>
Þimdi aþaðýdaki kodlarla bir form oluþturun ve scripti deneyin.

<p>
<ul>
<font face="courier new">
&lt;form action=&quot;http://www.sinanilyas.com/cgi-bin/ornek/mail.cgi&quot; method=&quot;POST&quot;&gt;<br>
&lt;pre&gt;<br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Adýnýz: &lt;input type=&quot;text&quot; name=&quot;isim&quot; size=30&gt;<br>
E-mail adresiniz: &lt;input type=&quot;text&quot; name=&quot;email&quot; size=30&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Web sayfanýz: &lt;input type=&quot;text&quot; name=&quot;web_sayfasi&quot; size=30&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Yaþýnýz: &lt;input type=&quot;text&quot; name=&quot;yas&quot; size=3&gt;<br>
&lt;/pre&gt;<br>
&lt;input type=&quot;submit&quot; value=&quot;Gönder&quot;&gt;<br>
&lt;input type=&quot;reset&quot; value=&quot;Tümünü Sil&quot;&gt;<br>
&lt;/form&gt;
</font>
</ul>

<p>
<img src="../grafik/ok-1.gif" width="13" height="15" align="absmiddle"> 
<a href="ornek/mail.html" target="ornek">Denemek için týklayýn</a>

<p>
Eðer herþey yolunda giderse birkaç dakika sonra form bilgileri e-mail adresine gelecektir.

<p>
Eðer form bilgilerini birkaç adrese birden göndermek istiyorsanýz adresleri aþaðýdaki gibi aralarýna virgül koyarak yazabilirsiniz.

<p>
<ul>
<font face="courier new">$gonderilen = 'mail@adres.com, mail2@adres2.com, mail3@adres3.com';</font>
</ul>

<p><div align="center">

<table border="0">
<tr><td>
<a href="bolum3.html">
Önceki Sayfa
</a>
</td><td>
<a href="index.html">
Konulara Dön
</a>
</td><td>
<a href="bolum5.html">
Sonraki Sayfa
</td></tr>
</table>
			<!-- Gövde metni sonu -->

			<p></p>
			

			<p style="text-align: center; font-size: 9px; margin-bottom: 0px;">
			&copy;1997-2005, <a href="http://www.sinanilyas.com/hakkimda" onmouseover="window.status='Özgeçmiþ'; return true;">Sinan ÝLYAS</a>
			</p>
		</td>
		<td style="background: url(/grafik/cerceve-sag.gif); width: 29px;"></td>
	</tr>
	<tr>
		<td style="background: url(/grafik/cerceve-sol-alt.gif); width:29px; height: 29px;"></td>
		<td style="background: url(/grafik/cerceve-alt.gif); height: 29px;"></td>
		<td style="background: url(/grafik/cerceve-sag-alt.gif); width:29px; height: 29px;"></td>
	</tr>
</table>

</body>

</html>
